<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√°o c√°o T√°c ƒë·ªông: Ti√™u th·ª• N·ªôi dung Khi√™u d√¢m & Tr·ª£ l√Ω AI ƒêa nƒÉng</title>
    <script src="https://cdn.tailwindcss.com"></script>
            <script src="common.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Th√™m v√†o sau c√°c link font -->
<link rel="stylesheet" href="common.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
        background-color: #fdfbf7; 
        color: #1f2937; }
        .chart-container { 
            position: relative; 
            width: 100%; 
            max-width: 600px; 
            margin: 0 auto; 
            height: 300px; 
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container { height: 350px; }
        }
        .active-tab { border-bottom: 2px solid #ea580c; color: #ea580c; font-weight: 600; }
        .inactive-tab { color: #6b7280; }
        .inactive-tab:hover { color: #374151; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .ai-glow { box-shadow: 0 0 20px rgba(234, 88, 12, 0.15); border: 1px solid rgba(234, 88, 12, 0.2); }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ea580c;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .speech-bubble { position: relative; background: #fff; border-radius: .4em; }
        .speech-bubble:after { content: ''; position: absolute; left: 0; top: 50%; width: 0; height: 0; border: 10px solid transparent; border-right-color: #fff; border-left: 0; border-top: 0; margin-top: -5px; margin-left: -10px; }
    /*------------------------------------*/
         @media (prefers-reduced-motion: reduce) {
      .icon-btn, .btn, .pill, .avatar, .more-info-btn, body::before, body::after, .detail, .bottom-nav, .avatar-wrap { 
        transition: none; 
        animation: none; 
      }
    }
     @media screen and (max-width: 480px) {
      .bottom-nav-item i {
        font-size: 18px;
      }
    }

    .bottom-nav-item.active {
      color: var(--brand);
      background: rgba(16, 185, 129, 0.1);
      transform: scale(1.05);
    }

    .bottom-nav-item:hover {
      color: var(--brand);
      background: rgba(16, 185, 129, 0.05);
      transform: scale(1.1);
    }
     @media screen and (max-width: 768px) {
      .bottom-nav-item {
        padding: 8px 2px;
      }
    }

    @media screen and (max-width: 480px) {
      .bottom-nav-item {
        padding: 6px 1px;
        font-size: 10px;
        gap: 2px;
        min-width: 50px;
      }
    }

    .bottom-nav-item i {
      font-size: 21px;
    }
      /* Bottom Navigation - Glass Style (C·∫≠p nh·∫≠t ƒë·ªÉ items lu√¥n ·ªü gi·ªØa) */
    .bottom-nav {
      position: fixed;
      bottom: 20px;
      left: 40%;
      transform: translateX(-50%);
      width: auto;
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 50px;
      padding: 8px 20px;
      display: flex;
      gap: 20px;
      justify-content: center; /* Th√™m ƒë·ªÉ items ·ªü gi·ªØa container */
      z-index: 50;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      animation: liquidFloat 4s ease-in-out infinite;
      max-width: 90vw;
    }

    @media screen and (max-width: 768px) {
      .bottom-nav {
        width: 50%;
        left: 10%;
        transform: none;
        justify-content: center; /* Thay space-around b·∫±ng center ƒë·ªÉ items ·ªü gi·ªØa m√†n h√¨nh mobile */
        max-width: none;
        padding: 8px 0;
        gap: 10px; /* Gi·∫£m gap tr√™n mobile ƒë·ªÉ v·ª´a m√†n h√¨nh */
        border-radius: 25px;
        bottom: 10px;
      }
    }

    @media screen and (max-width: 480px) {
      .bottom-nav {
        padding: 6px 0;
        bottom: 5px;
        border-radius: 20px;
        gap: 5px; /* Gi·∫£m th√™m gap cho m√†n h√¨nh nh·ªè */
      }
    }

    .bottom-nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      color: var(--muted);
      text-decoration: none;
      font-size: 12px;
      transition: all 0.3s ease;
      padding: 8px 4px;
      flex: 1;
      border-radius: 12px;
      min-width: 60px; /* ƒê·∫£m b·∫£o m·ªói item c√≥ chi·ªÅu r·ªông t·ªëi thi·ªÉu ƒë·ªÉ c√¢n b·∫±ng */
    }

    @media screen and (max-width: 768px) {
      .bottom-nav-item {
        padding: 8px 2px;
      }
    }

    @media screen and (max-width: 480px) {
      .bottom-nav-item {
        padding: 6px 1px;
        font-size: 10px;
        gap: 2px;
        min-width: 50px;
      }
    }

    .bottom-nav-item i {
      font-size: 21px;
    }

    @media screen and (max-width: 480px) {
      .bottom-nav-item i {
        font-size: 18px;
      }
    }

    .bottom-nav-item.active {
      color: var(--brand);
      background: rgba(16, 185, 129, 0.1);
      transform: scale(1.05);
    }

    .bottom-nav-item:hover {
      color: var(--brand);
      background: rgba(16, 185, 129, 0.05);
      transform: scale(1.1);
    }
    </style>
    <!-- Chosen Palette: Warm Neutrals & Alert Orange (Background: #fdfbf7, Text: #1f2937, Accent/Alert: #ea580c) -->
    <!-- Application Structure Plan: We have enhanced the Dashboard with multi-modal AI capabilities. 
         1. Main Research Sections: Static but enriched with "Listen ‚ú®" buttons (TTS).
         2. AI Hub (New): A unified interface for Chat, Deep Analysis (Google Search), and Mood Check-ins.
         3. Dynamic Recovery Plan: Improved AI logic for better personalization.
         The UI uses a sidebar-like grid on desktop for the AI Hub to keep interactions secondary to the content. -->
    <!-- Visualization & Content Choices: 
         - Line Charts & Radar Charts: For data visualization.
         - Gemini 2.5 Flash: For core logic and search-grounded research.
         - Gemini TTS: For audio accessibility.
         CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. 
    -->
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-bold text-gray-800 tracking-tight">Neuro<span class="text-orange-600">Impact</span></span>
                    <span class="hidden md:block ml-4 text-sm text-gray-500 border-l pl-4 border-gray-300">Nghi√™n c·ª©u & Tr·ª£ l√Ω AI ƒêa nƒÉng</span>
                </div>
                <nav class="hidden md:flex space-x-6">
                    <button onclick="switchTab('overview')" id="nav-overview" class="active-tab px-1 pt-1 text-sm font-medium transition-all">T·ªïng quan</button>
                    <button onclick="switchTab('brain')" id="nav-brain" class="inactive-tab px-1 pt-1 text-sm font-medium transition-all">N√£o b·ªô</button>
                    <button onclick="switchTab('mind')" id="nav-mind" class="inactive-tab px-1 pt-1 text-sm font-medium transition-all">T√¢m l√Ω</button>
                    <button onclick="switchTab('social')" id="nav-social" class="inactive-tab px-1 pt-1 text-sm font-medium transition-all">M·ªëi quan h·ªá</button>
                    <button onclick="switchTab('ai-hub')" id="nav-ai-hub" class="inactive-tab px-1 pt-1 text-sm font-medium transition-all flex items-center bg-orange-50 px-3 rounded-full py-1">Trung t√¢m AI ‚ú®</button>
                </nav>
                <div class="md:hidden">
                    <select onchange="switchTab(this.value)" class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md bg-gray-50 text-gray-900">
                        <option value="overview">T·ªïng quan</option>
                        <option value="brain">N√£o b·ªô & Th·∫ßn kinh</option>
                        <option value="mind">S·ª©c kh·ªèe T√¢m th·∫ßn</option>
                        <option value="social">M·ªëi quan h·ªá & X√£ h·ªôi</option>
                        <option value="ai-hub">Trung t√¢m AI ‚ú®</option>
                    </select>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow bg-[#fdfbf7] p-4 sm:p-6 lg:p-8">
        <div class="max-w-6xl mx-auto">

            <!-- VIEW: OVERVIEW -->
            <section id="view-overview" class="space-y-8">
                <div class="text-center py-12 bg-white rounded-3xl shadow-sm border border-gray-100 mb-8">
                    <h1 class="text-4xl font-extrabold text-gray-900 mb-4 px-4">Gi·∫£i m√£ T√°c ƒë·ªông c·ªßa Phim Khi√™u d√¢m</h1>
                    <p class="text-xl text-gray-600 max-w-3xl mx-auto px-6">
                        Kh√°m ph√° khoa h·ªçc ƒë·∫±ng sau s·ª± h∆∞ng ph·∫•n nh√¢n t·∫°o v√† nh·∫≠n s·ª± h·ªó tr·ª£ th√¥ng minh t·ª´ AI ƒë·ªÉ kh√¥i ph·ª•c l·∫°i s·ª± c√¢n b·∫±ng t·ª± nhi√™n.
                    </p>
                    <div class="mt-6 flex justify-center space-x-4">
                        <button onclick="playSectionTTS('view-overview-text')" class="flex items-center space-x-2 text-orange-600 border border-orange-200 px-4 py-2 rounded-full hover:bg-orange-50 transition-all text-sm font-medium">
                            <span>Nghe t√≥m t·∫Øt ‚ú®</span>
                        </button>
                    </div>
                </div>

                <div id="view-overview-text" class="hidden">ƒê√¢y l√† b√°o c√°o nghi√™n c·ª©u v·ªÅ ·∫£nh h∆∞·ªüng c·ªßa phim khi√™u d√¢m ƒë·∫øn n√£o b·ªô, t√¢m l√Ω v√† c√°c m·ªëi quan h·ªá x√£ h·ªôi. B√°o c√°o cung c·∫•p ki·∫øn th·ª©c khoa h·ªçc v√† gi·∫£i ph√°p ph·ª•c h·ªìi th√¥ng qua tr·ª£ l√Ω AI.</div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 card-hover">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">S∆∞∆°ng m√π n√£o</h3>
                        <p class="text-gray-600 text-sm">C·∫£m gi√°c m·ªát m·ªèi tinh th·∫ßn v√† gi·∫£m tr√≠ nh·ªõ sau khi xem qu√° ƒë·ªô.</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 card-hover">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">M·∫•t nh·∫°y c·∫£m</h3>
                        <p class="text-gray-600 text-sm">N√£o b·ªô c·∫ßn nh·ªØng k√≠ch th√≠ch m·∫°nh h∆°n ƒë·ªÉ c·∫£m th·∫•y th·ªèa m√£n.</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 card-hover">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">PIED</h3>
                        <p class="text-gray-600 text-sm">R·ªëi lo·∫°n ch·ª©c nƒÉng do s·ª± l·ªá thu·ªôc v√†o h√¨nh ·∫£nh nh√¢n t·∫°o.</p>
                    </div>
                </div>
            </section>

            <!-- VIEW: BRAIN (Enhanced with TTS) -->
            <section id="view-brain" class="hidden space-y-8 animate-fade-in">
                <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-200">
                    <div class="flex justify-between items-start mb-6">
                        <h2 class="text-2xl font-bold text-gray-900">1. T√°c ƒë·ªông ƒë·∫øn N√£o b·ªô</h2>
                        <button onclick="playSectionTTS('brain-content-text')" class="text-orange-600 text-sm flex items-center bg-orange-50 px-3 py-1 rounded-full font-medium">
                            <span>Nghe n·ªôi dung ‚ú®</span>
                        </button>
                    </div>
                    <div id="brain-content-text" class="text-gray-600 mb-8 leading-relaxed">
                        Phim khi√™u d√¢m k√≠ch th√≠ch h·ªá th·ªëng ph·∫ßn th∆∞·ªüng ti·∫øt ra Dopamine ·ªü m·ª©c c·ª±c ƒë·∫°i. Vi·ªác l·∫∑p l·∫°i n√†y khi·∫øn n√£o b·ªô "t·ª± v·ªá" b·∫±ng c√°ch gi·∫£m s·ªë l∆∞·ª£ng th·ª• th·ªÉ, d·∫´n ƒë·∫øn hi·ªán t∆∞·ª£ng gi·∫£m nh·∫°y c·∫£m. B·∫°n s·∫Ω th·∫•y m√¨nh kh√≥ t·∫≠p trung v√†o nh·ªØng vi·ªác ƒë√≤i h·ªèi s·ª± ki√™n nh·∫´n v√† √≠t c·∫£m nh·∫≠n ƒë∆∞·ª£c ni·ªÅm vui t·ª´ nh·ªØng s·ªü th√≠ch b√¨nh th∆∞·ªùng.
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2 bg-gray-50 rounded-xl p-4">
                            <div class="chart-container">
                                <canvas id="dopamineChart"></canvas>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div class="p-4 bg-orange-50 rounded-xl border border-orange-100">
                                <h4 class="font-bold text-orange-800 text-sm mb-1">Th√πy tr√°n b·ªã ·∫£nh h∆∞·ªüng</h4>
                                <p class="text-xs text-gray-700">Kh·∫£ nƒÉng ki·ªÉm so√°t xung ƒë·ªông gi·∫£m s√∫t, khi·∫øn vi·ªác "n√≥i kh√¥ng" tr·ªü n√™n kh√≥ khƒÉn h∆°n.</p>
                            </div>
                            <div class="p-4 bg-gray-100 rounded-xl">
                                <h4 class="font-bold text-gray-800 text-sm mb-1">Neuroplasticity</h4>
                                <p class="text-xs text-gray-700">N√£o b·ªô c√≥ th·ªÉ t·ª± ch·ªØa l√†nh n·∫øu ƒë∆∞·ª£c ngh·ªâ ng∆°i (Dopamine Reboot) trong √≠t nh·∫•t 30-90 ng√†y.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- VIEW: MIND -->
            <section id="view-mind" class="hidden space-y-8 animate-fade-in">
                <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4 border-b pb-2">2. S·ª©c kh·ªèe T√¢m th·∫ßn</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4">
                        <div class="p-4 border rounded-lg hover:bg-orange-50 transition-colors">
                            <h4 class="font-bold text-gray-800">S∆∞∆°ng m√π n√£o (Brain Fog)</h4>
                            <p class="text-sm text-gray-600">C·∫£m gi√°c m·ªát m·ªèi, kh√≥ t·∫≠p trung v√† suy gi·∫£m tr√≠ nh·ªõ ng·∫Øn h·∫°n sau khi ti√™u th·ª• qu√° ƒë·ªô.</p>
                        </div>
                        <div class="p-4 border rounded-lg hover:bg-orange-50 transition-colors">
                            <h4 class="font-bold text-gray-800">R·ªëi lo·∫°n h√†nh vi</h4>
                            <p class="text-sm text-gray-600">S·ª± l·ªá thu·ªôc khi·∫øn b·∫°n l∆° l√† c√¥ng vi·ªác v√† c√°c tr√°ch nhi·ªám x√£ h·ªôi quan tr·ªçng.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- VIEW: SOCIAL -->
            <section id="view-social" class="hidden space-y-8 animate-fade-in">
                <div class="bg-white p-8 rounded-2xl shadow-sm border border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4 border-b pb-2">3. M·ªëi quan h·ªá & X√£ h·ªôi</h2>
                    <div class="flex flex-col md:flex-row gap-8 items-center mt-4">
                        <div class="w-full md:w-1/2">
                            <div class="chart-container">
                                <canvas id="relationshipRadar"></canvas>
                            </div>
                        </div>
                        <div class="w-full md:w-1/2 space-y-3 text-sm text-gray-600">
                            <p>Phim khi√™u d√¢m l√†m l·ªách l·∫°c nh·∫≠n th·ª©c v·ªÅ t√¨nh y√™u v√† t√¨nh d·ª•c th·ª±c t·∫ø, d·∫´n ƒë·∫øn s·ª± thi·∫øu th·ªèa m√£n v√† xa c√°ch v·ªõi b·∫°n ƒë·ªùi.</p>
                            <p class="bg-red-50 p-3 rounded border-l-4 border-red-500">Ng∆∞·ªùi xem th∆∞·ªùng c√≥ xu h∆∞·ªõng t·ª± c√¥ l·∫≠p v√† c·∫£m th·∫•y x·∫•u h·ªï trong giao ti·∫øp x√£ h·ªôi.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- VIEW: AI HUB (New Unified View) -->
            <section id="view-ai-hub" class="hidden space-y-6 animate-fade-in">
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                    
                    <!-- LEFT SIDE: Interaction Tools -->
                    <div class="lg:col-span-4 space-y-6">
                        <!-- Mood Check-in -->
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-orange-100 ai-glow">
                            <h3 class="font-bold text-gray-900 mb-3 flex items-center">
                                <span class="mr-2 text-xl">üåà</span> Ki·ªÉm tra T√¢m tr·∫°ng ‚ú®
                            </h3>
                            <div class="space-y-3">
                                <p class="text-xs text-gray-500">B·∫°n ƒëang c·∫£m th·∫•y th·∫ø n√†o ngay b√¢y gi·ªù?</p>
                                <div class="grid grid-cols-3 gap-2">
                                    <button onclick="moodCheck('stress')" class="p-2 bg-gray-50 rounded-lg text-xs hover:bg-orange-50 border border-transparent hover:border-orange-200 transition-all">CƒÉng th·∫≥ng</button>
                                    <button onclick="moodCheck('sad')" class="p-2 bg-gray-50 rounded-lg text-xs hover:bg-orange-50 border border-transparent hover:border-orange-200 transition-all">Bu·ªìn b√£</button>
                                    <button onclick="moodCheck('urge')" class="p-2 bg-gray-50 rounded-lg text-xs hover:bg-red-50 border border-transparent hover:border-red-200 transition-all">B·ªã th√¥i th√∫c</button>
                                </div>
                                <div id="mood-feedback" class="hidden text-xs p-3 bg-blue-50 text-blue-800 rounded-lg italic"></div>
                            </div>
                        </div>

                        <!-- Chat & Research Tabs -->
                        <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-200">
                            <div class="flex space-x-2 mb-4 border-b pb-2">
                                <button onclick="switchAiMode('chat')" id="tab-chat" class="text-sm font-bold text-orange-600 border-b-2 border-orange-600 pb-1">Tr√≤ chuy·ªán ‚ú®</button>
                                <button onclick="switchAiMode('search')" id="tab-search" class="text-sm font-medium text-gray-400 pb-1">Nghi√™n c·ª©u s√¢u ‚ú®</button>
                            </div>

                            <div id="ai-input-area" class="space-y-4">
                                <textarea id="ai-query" rows="4" class="w-full p-3 text-sm border border-gray-200 rounded-xl focus:ring-2 focus:ring-orange-500 focus:outline-none transition-all" placeholder="ƒê·∫∑t c√¢u h·ªèi ho·∫∑c ch·ªß ƒë·ªÅ b·∫°n mu·ªën nghi√™n c·ª©u..."></textarea>
                                <button id="btn-ai-submit" onclick="handleAiSubmit()" class="w-full bg-orange-600 text-white py-3 rounded-xl hover:bg-orange-700 transition-all font-bold flex justify-center items-center shadow-md">
                                    <span id="btn-ai-text">G·ª≠i y√™u c·∫ßu ‚ú®</span>
                                    <div id="loader-ai" class="loading-spinner hidden ml-2"></div>
                                </button>
                                <button onclick="generatePlan()" class="w-full bg-white border border-orange-200 text-orange-600 py-2 rounded-xl text-xs font-bold hover:bg-orange-50">L·∫≠p k·∫ø ho·∫°ch ph·ª•c h·ªìi 30 ng√†y ‚ú®</button>
                            </div>
                        </div>
                    </div>

                    <!-- RIGHT SIDE: AI Results -->
                    <div class="lg:col-span-8 space-y-4">
                        <div class="bg-white rounded-2xl shadow-sm border border-gray-200 h-full min-h-[500px] flex flex-col">
                            <div class="p-4 border-b flex justify-between items-center bg-gray-50 rounded-t-2xl">
                                <span id="ai-status-label" class="text-xs font-bold text-gray-500 uppercase tracking-widest">Ph·∫£n h·ªìi t·ª´ Gemini AI</span>
                                <div id="ai-audio-controls" class="hidden flex items-center space-x-2">
                                    <button onclick="playResponseTTS()" class="text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full font-bold">Nghe ‚ú®</button>
                                </div>
                            </div>
                            <div id="ai-response-container" class="p-6 flex-grow overflow-y-auto">
                                <div id="ai-empty-state" class="h-full flex flex-col items-center justify-center text-center space-y-4 opacity-50">
                                    <div class="text-5xl">‚ú®</div>
                                    <p class="text-sm text-gray-500 max-w-xs italic">H√£y ƒë·∫∑t c√¢u h·ªèi ho·∫∑c ch·ªçn m·ªôt c√¥ng c·ª• b√™n tr√°i ƒë·ªÉ b·∫Øt ƒë·∫ßu t∆∞∆°ng t√°c v·ªõi tr√≠ tu·ªá nh√¢n t·∫°o.</p>
                                </div>
                                <div id="ai-text-output" class="hidden prose prose-sm max-w-none text-gray-700 leading-relaxed whitespace-pre-wrap"></div>
                                <div id="ai-sources" class="hidden mt-6 pt-4 border-t border-gray-100">
                                    <h4 class="text-xs font-bold text-gray-400 mb-2 uppercase tracking-tighter">Ngu·ªìn tham kh·∫£o khoa h·ªçc:</h4>
                                    <ul id="source-list" class="space-y-1 text-xs text-blue-600"></ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </main>
 <!-- Bottom Navigation -->
 <nav class="bottom-nav">
    <a href="index.html" class="bottom-nav-item active">
      <i class='bx bx-home'></i>
      <span>Home</span>
    </a>
    <a href="brainot.html" class="bottom-nav-item">
      <i class='bx bx-grid-alt'></i>
      <span>BrainRot</span>
    </a>
    <a href="Pornography.html" class="bottom-nav-item">
      <i class='bx bx-book'></i>
      <span>Pornography</span>
    </a>
     <a href="DeepDive.html" class="bottom-nav-item">
      <i class='bx bx-book'></i>
      <span>DeepDive</span>
    </a>
  </nav>
 

    <script>
        const apiKey = ""; // Runtime provides key
        const state = { 
            currentTab: 'overview',
            aiMode: 'chat', // 'chat' or 'search'
            lastAiResponse: ""
        };

        // Navigation
        function switchTab(tabId) {
            // Safety: include all possible sections
            const sectionIds = ['overview', 'brain', 'mind', 'social', 'ai-hub'];
            
            sectionIds.forEach(id => {
                const el = document.getElementById(`view-${id}`);
                if (el) el.classList.add('hidden');
            });
            
            const activeSection = document.getElementById(`view-${tabId}`);
            if (activeSection) activeSection.classList.remove('hidden');
            
            // UI classes update
            sectionIds.forEach(id => {
                const btn = document.getElementById(`nav-${id}`);
                if (btn) {
                    if (id === tabId) {
                        btn.classList.replace('inactive-tab', 'active-tab');
                    } else {
                        btn.classList.replace('active-tab', 'inactive-tab');
                    }
                }
            });

            state.currentTab = tabId;
            if (tabId === 'brain') initCharts();
        }

        function switchAiMode(mode) {
            state.aiMode = mode;
            const tabChat = document.getElementById('tab-chat');
            const tabSearch = document.getElementById('tab-search');
            const placeholder = mode === 'chat' ? "H·ªèi b·∫•t c·ª© ƒëi·ªÅu g√¨ v·ªÅ n√£o b·ªô v√† ph·ª•c h·ªìi..." : "Nh·∫≠p ch·ªß ƒë·ªÅ khoa h·ªçc c·∫ßn t√¨m ki·∫øm chi ti·∫øt (v·ªõi Google Search)...";
            document.getElementById('ai-query').placeholder = placeholder;

            if (mode === 'chat') {
                tabChat.className = "text-sm font-bold text-orange-600 border-b-2 border-orange-600 pb-1";
                tabSearch.className = "text-sm font-medium text-gray-400 pb-1";
            } else {
                tabSearch.className = "text-sm font-bold text-orange-600 border-b-2 border-orange-600 pb-1";
                tabChat.className = "text-sm font-medium text-gray-400 pb-1";
            }
        }

        // --- GEMINI CORE LOGIC ---

        async function handleAiSubmit() {
            const query = document.getElementById('ai-query').value.trim();
            if (!query) return;

            setAiLoading(true);
            
            const systemPrompt = "B·∫°n l√† chuy√™n gia v·ªÅ Neurobiology v√† t√¢m l√Ω h·ªçc cai nghi·ªán. Tr·∫£ l·ªùi b·∫±ng ti·∫øng Vi·ªát, khoa h·ªçc, th·ª±c t·∫ø v√† ƒë·ªìng c·∫£m. N·∫øu trong ch·∫ø ƒë·ªô Nghi√™n c·ª©u, h√£y s·ª≠ d·ª•ng th√¥ng tin t·ª´ Google Search ƒë·ªÉ cung c·∫•p d·ªØ li·ªáu m·ªõi nh·∫•t.";
            
            const payload = {
                contents: [{ parts: [{ text: query }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] }
            };

            if (state.aiMode === 'search') {
                payload.tools = [{ "google_search": {} }];
            }

            try {
                const response = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, payload);
                const data = await response.json();
                
                const textOutput = data.candidates?.[0]?.content?.parts?.[0]?.text || "Kh√¥ng t√¨m th·∫•y c√¢u tr·∫£ l·ªùi.";
                const sources = data.candidates?.[0]?.groundingMetadata?.groundingAttributions || [];

                displayAiResponse(textOutput, sources);
            } catch (error) {
                displayAiResponse("ƒê√£ x·∫£y ra l·ªói khi k·∫øt n·ªëi v·ªõi AI. Vui l√≤ng th·ª≠ l·∫°i sau.");
            } finally {
                setAiLoading(false);
            }
        }

        async function moodCheck(type) {
            const feedback = document.getElementById('mood-feedback');
            feedback.innerHTML = "AI ƒëang suy nghƒ© l·ªùi khuy√™n cho b·∫°n... ‚ú®";
            feedback.classList.remove('hidden');

            const prompts = {
                stress: "T√¥i ƒëang c·∫£m th·∫•y r·∫•t cƒÉng th·∫≥ng. H√£y cho t√¥i 1 l·ªùi khuy√™n ng·∫Øn g·ªçn ƒë·ªÉ b√¨nh tƒ©nh l·∫°i.",
                sad: "T√¥i ƒëang c·∫£m th·∫•y bu·ªìn b√£ v√† tr·ªëng r·ªóng. H√£y cho t√¥i 1 l·ªùi khuy√™n kh√≠ch l·ªá tinh th·∫ßn.",
                urge: "T√¥i ƒëang b·ªã th√¥i th√∫c m√£nh li·ªát mu·ªën xem phim sex. H√£y gi√∫p t√¥i tho√°t kh·ªèi c·∫£m gi√°c n√†y ngay l·∫≠p t·ª©c v·ªõi k·ªπ thu·∫≠t t√¢m l√Ω."
            };

            const payload = {
                contents: [{ parts: [{ text: prompts[type] }] }],
                systemInstruction: { parts: [{ text: "Tr·∫£ l·ªùi c·ª±c k·ª≥ ng·∫Øn g·ªçn, t·ªëi ƒëa 2 c√¢u, gi·ªçng vƒÉn h·ªó tr·ª£ v√† kh·∫©n c·∫•p n·∫øu c·∫ßn." }] }
            };

            try {
                const response = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, payload);
                const data = await response.json();
                feedback.innerHTML = `‚ú® ${data.candidates?.[0]?.content?.parts?.[0]?.text}`;
            } catch (e) {
                feedback.innerHTML = "H√£y h√≠t th·ªü s√¢u v√† r·ªùi xa thi·∫øt b·ªã ƒëi·ªán t·ª≠ ngay nh√©!";
            }
        }

        async function generatePlan() {
            document.getElementById('ai-query').value = "H√£y l·∫≠p cho t√¥i k·∫ø ho·∫°ch ph·ª•c h·ªìi n√£o b·ªô 30 ng√†y chi ti·∫øt nh·∫•t.";
            handleAiSubmit();
        }

        // --- TTS (TEXT TO SPEECH) ---

        async function playSectionTTS(sectionId) {
            const el = document.getElementById(sectionId);
            if (!el) return;
            const text = el.innerText;
            await callGeminiTTS(text);
        }

        async function playResponseTTS() {
            if (state.lastAiResponse) {
                await callGeminiTTS(state.lastAiResponse);
            }
        }

        async function callGeminiTTS(text) {
            const payload = {
                contents: [{ parts: [{ text: `ƒê·ªçc vƒÉn b·∫£n sau m·ªôt c√°ch r√µ r√†ng v√† truy·ªÅn c·∫£m: ${text.substring(0, 1000)}` }] }],
                generationConfig: { 
                    responseModalities: ["AUDIO"],
                    speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Aoede" } } }
                }
            };

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                const pcmData = data.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
                if (pcmData) {
                    const audioBlob = pcmToWav(pcmData, 24000); // 24kHz default for Gemini TTS
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const audio = new Audio(audioUrl);
                    audio.play();
                }
            } catch (e) {
                console.error("TTS Error:", e);
            }
        }

        // Helper: PCM to WAV
        function pcmToWav(base64Pcm, sampleRate) {
            const binaryString = window.atob(base64Pcm);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) bytes[i] = binaryString.charCodeAt(i);
            const buffer = new ArrayBuffer(44 + bytes.length);
            const view = new DataView(buffer);
            const writeString = (offset, string) => { for (let i = 0; i < string.length; i++) view.setUint8(offset + i, string.charCodeAt(i)); };
            writeString(0, 'RIFF');
            view.setUint32(4, 36 + bytes.length, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, 1, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true);
            view.setUint16(32, 2, true);
            view.setUint16(34, 16, true);
            writeString(36, 'data');
            view.setUint32(40, bytes.length, true);
            for (let i = 0; i < bytes.length; i++) view.setUint8(44 + i, bytes[i]);
            return new Blob([buffer], { type: 'audio/wav' });
        }

        // --- UTILS ---

        async function fetchWithRetry(url, payload, retries = 5, delay = 1000) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (response.ok) return response;
                } catch (e) {}
                await new Promise(r => setTimeout(r, delay * Math.pow(2, i)));
            }
            throw new Error('All retries failed');
        }

        function setAiLoading(isLoading) {
            const loader = document.getElementById('loader-ai');
            const btnText = document.getElementById('btn-ai-text');
            const btn = document.getElementById('btn-ai-submit');
            
            if (isLoading) {
                loader.classList.remove('hidden');
                btnText.classList.add('opacity-50');
                btn.disabled = true;
                document.getElementById('ai-empty-state').classList.add('hidden');
                document.getElementById('ai-text-output').classList.add('hidden');
                document.getElementById('ai-audio-controls').classList.add('hidden');
                document.getElementById('ai-sources').classList.add('hidden');
            } else {
                loader.classList.add('hidden');
                btnText.classList.remove('opacity-50');
                btn.disabled = false;
            }
        }

        function displayAiResponse(text, sources = []) {
            const output = document.getElementById('ai-text-output');
            const sourceContainer = document.getElementById('ai-sources');
            const sourceList = document.getElementById('source-list');
            const audioControls = document.getElementById('ai-audio-controls');

            state.lastAiResponse = text;
            output.innerText = text;
            output.classList.remove('hidden');
            audioControls.classList.remove('hidden');

            if (sources.length > 0) {
                sourceList.innerHTML = sources.map(s => `<li><a href="${s.web?.uri}" target="_blank" class="hover:underline">üîó ${s.web?.title || s.web?.uri}</a></li>`).join('');
                sourceContainer.classList.remove('hidden');
            } else {
                sourceContainer.classList.add('hidden');
            }
        }

        // --- CHARTS ---
        function initCharts() {
            const canvas = document.getElementById('dopamineChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            if (window.myChart) window.myChart.destroy();
            window.myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['S√°ng', 'Tr∆∞a', 'X·∫ø', 'T·ªëi', 'Khuya'],
                    datasets: [{
                        label: 'Dopamine T·ª± nhi√™n',
                        data: [100, 120, 110, 130, 90],
                        borderColor: '#10b981',
                        tension: 0.4
                    }, {
                        label: 'K√≠ch th√≠ch Phim sex',
                        data: [100, 100, 450, 80, 50],
                        borderColor: '#ea580c',
                        tension: 0.1
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }

        window.onload = () => {
            // Initial view
            switchTab('overview');
            
            // Initialize Radar Chart (Static)
            const radarCanvas = document.getElementById('relationshipRadar');
            if (radarCanvas) {
                const ctxRadar = radarCanvas.getContext('2d');
                new Chart(ctxRadar, {
                    type: 'radar',
                    data: {
                        labels: ['K·∫øt n·ªëi', 'Th·ªèa m√£n', 'Nh·∫≠n th·ª©c', 'T·ª± tin', 'Giao ti·∫øp'],
                        datasets: [
                            { label: 'L√†nh m·∫°nh', data: [90, 85, 95, 90, 88], backgroundColor: 'rgba(16, 185, 129, 0.2)', borderColor: '#10b981' },
                            { label: 'L·∫°m d·ª•ng', data: [35, 45, 25, 40, 30], backgroundColor: 'rgba(239, 68, 68, 0.2)', borderColor: '#ef4444' }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            }
        }
    </script>
 

</body>
</html>